#!/bin/sh

echo
echo
echo
echo "############################################################################################################"
echo "############################################################################################################"
echo "#                                                                                                          #"
echo "#                               üö® PRE-COMMIT CHECK IN PROGRESS  üîç                                        #"
echo "#                                                                                                          #"
echo "############################################################################################################"
echo "############################################################################################################"
echo
echo
echo

./gradlew ktlintCheck
RESULT=$?

if [ $RESULT -ne 0 ]; then

   echo
   echo "‚ùå  ktlintCheck failed! FIX issues before committing!  ‚ùå"
   echo

  FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(kt|kts)$')

  if [ -n "$FILES" ]; then
    echo
    echo "üîß  Files that require formatting or fixes (you can run the following commands):"
    echo

    for file in $FILES; do
      echo
      echo "  ./gradlew ktlintFormat -PinternalKtlintFiles=$file"
      echo
    done

    echo
    echo "üí° Or run this to format all at once:"
    echo "  ./gradlew ktlintFormat"
    echo
  else
    echo "‚ÑπÔ∏è  No staged Kotlin files detected."
  fi

    echo
    echo "######################################################################################"
    echo "#                                                                                   #"
    echo "#                              ‚ùå COMMIT REJECTED ‚ùå                              #"
    echo "#                                                                                #"
    echo "##################################################################################"
    echo
  exit 1
fi

echo
echo "######################################################################################"
echo "#                                                                                   #"
echo "#                             ‚úÖ PRE-COMMIT CHECK PASSED ‚úÖ                       #"
echo "#                                                                                #"
echo "##################################################################################"
echo

exit 0
